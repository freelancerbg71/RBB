---
import Layout from '../../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { UI_TEXT, CTA_TEXT, getCategoryName, CATEGORY_NAMES, type Locale } from '../../../config/affiliate';
import { getDefaultHeroImageForPost } from '../../../utils/blog-hero';
import { toKnownCategorySlug } from '../../../utils/category';

const locale: Locale = 'fr';

const allPosts = await getCollection('blog', ({ data }) => data.locale === locale);
const sortedPosts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const ui = UI_TEXT[locale];
const cta = CTA_TEXT[locale];

const title = 'Все руководства по играм в казино | Read Between Bets';
const description = 'Изучите нашу образовательную коллекцию руководств по играм в казино. Узнайте, как работают слоты, краш-игры, лайв-казино и настольные игры.';

const availableCategorySlugs = Object.keys(CATEGORY_NAMES).filter((s) => s !== 'reviews');
const categoriesInPosts = [...new Set(allPosts.map((p) => toKnownCategorySlug(p.data.category)))].filter(Boolean);
const categories = availableCategorySlugs.filter((slug) => categoriesInPosts.includes(slug));
---

<Layout title={title} description={description} locale={locale} alternates={{ en: '/blog/', fr: '/ru/blog/' }}>
  <section class="relative py-16 bg-dark-800/50 border-b border-dark-700 overflow-hidden">
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_100%_0%,rgba(16,185,129,0.15),transparent_40%),radial-gradient(circle_at_0%_100%,rgba(52,211,153,0.1),transparent_40%)]"></div>
    <div class="relative section-padding max-w-7xl mx-auto">
      <div>
        <h1 class="text-4xl sm:text-5xl font-bold text-white mb-4">Все руководства</h1>
        <p class="text-gray-400 text-lg max-w-2xl">Просмотрите {sortedPosts.length}+ обучающих руководств. Фильтровать по категории.</p>
      </div>
    </div>
  </section>

  <section class="py-6 border-b border-dark-700 sticky top-16 lg:top-20 bg-dark-900/95 backdrop-blur-md z-40">
    <div class="section-padding max-w-7xl mx-auto">
      <div>
        <div class="flex items-center gap-4 overflow-x-auto pb-2 scrollbar-hide">
        <span class="text-gray-500 text-sm whitespace-nowrap">{ui.filterBy}</span>
        <a href="/ru/blog" class="px-4 py-2 rounded-full bg-brand-500 text-dark-900 text-sm font-semibold whitespace-nowrap">{ui.all}</a>
        {categories.map((catSlug) => (
          <a
            href={`/ru/category/${catSlug}`}
            class="px-4 py-2 rounded-full bg-dark-800 text-gray-300 hover:text-white text-sm font-medium whitespace-nowrap border border-dark-700 hover:border-brand-500/50 transition-colors"
          >
            {getCategoryName(catSlug, locale)}
          </a>
        ))}
        </div>
      </div>
    </div>
  </section>

  <section class="py-12">
    <div class="section-padding max-w-7xl mx-auto">
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {sortedPosts.map((post) => (
          <article class="group relative flex flex-col cursor-pointer pb-6 border-b border-light/5 lg:border-none lg:pb-0">
            <a href={`/ru/blog/${post.data.urlSlug}`} class="block w-full">
              <div class="aspect-[4/3] bg-dark-800 relative overflow-hidden mb-5 rounded">
                <img
                  src={getDefaultHeroImageForPost(post)}
                  alt={post.data.title}
                  class="w-full h-full object-cover scale-100 group-hover:scale-105 transition-transform duration-700"
                  loading="lazy"
                />
                {post.data.featured && (
                  <div class="absolute top-4 left-4">
                    <span class="px-3 py-1 bg-white text-dark-900 text-[10px] uppercase tracking-widest font-bold">Выбор редакции</span>
                  </div>
                )}
              </div>
            </a>
            <div class="flex-1 flex flex-col">
              <div class="flex items-center gap-2 mb-3 flex-wrap">
                <span class="text-brand-500 font-sans text-[10px] uppercase tracking-widest">{post.data.category}</span>
                {post.data.rtp && (
                  <span class="text-gray-500 font-sans text-[10px] uppercase tracking-widest border-l border-gray-700 pl-2">RTP {post.data.rtp}</span>
                )}
                {post.data.gameProvider && (
                  <span class="text-gray-500 font-sans text-[10px] uppercase tracking-widest border-l border-gray-700 pl-2">{post.data.gameProvider}</span>
                )}
              </div>
              <a href={`/ru/blog/${post.data.urlSlug}`} class="block mb-3">
                <h2 class="text-xl font-semibold text-gray-200 group-hover:text-white transition-colors line-clamp-2 leading-snug">{post.data.title}</h2>
              </a>
              <p class="text-gray-400 text-sm line-clamp-3 mb-6 flex-1 leading-relaxed">{post.data.description}</p>
              <div class="flex items-center justify-between text-xs font-sans text-gray-500 pt-4 border-t border-dark-700">
                <span class="uppercase tracking-wider">{post.data.author}</span>
                <span>{post.data.pubDate.toLocaleDateString('ru-RU', { month: 'short', day: 'numeric', year: 'numeric' })}</span>
              </div>
            </div>
          </article>
        ))}
      </div>

      {sortedPosts.length === 0 && (
        <div class="text-center py-20">
          <div class="text-6xl mb-4">Docs</div>
          <h3 class="text-xl font-bold text-white mb-2">Пока нет руководств</h3>
          <p class="text-gray-400">Заходите позже за новым контентом.</p>
        </div>
      )}
    </div>
  </section>
</Layout>

<style>
  .scrollbar-hide::-webkit-scrollbar {
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>
\n
