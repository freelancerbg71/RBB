---
import Layout from '../../../layouts/Layout.astro';
import BlogTabs from '../../../components/BlogTabs.astro';
import { getCollection } from 'astro:content';
import type { Locale } from '../../../config/affiliate';
import { getDefaultHeroImageForPost } from '../../../utils/blog-hero';

const locale: Locale = 'fr';

const allPosts = await getCollection('blog', ({ data }) => {
  return data.locale === locale && data.postType === 'insight';
});
const sortedPosts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const title = 'Insights | Read Between Bets';
const description = 'Notes editoriales nettes sur actualites, mecaniques produit et signaux de risque. Informatif uniquement.';
---

<Layout title={title} description={description} locale={locale} alternates={{ en: '/blog/insights/', fr: '/fr/blog/insights/' }}>
  <section class="relative py-16 bg-dark-800/50 border-b border-dark-700 overflow-hidden">
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_100%_0%,rgba(16,185,129,0.15),transparent_40%),radial-gradient(circle_at_0%_100%,rgba(52,211,153,0.1),transparent_40%)]"></div>
    <div class="relative section-padding max-w-7xl mx-auto">
      <div>
        <h1 class="text-4xl sm:text-5xl font-bold text-white mb-4">Insights</h1>
        <p class="text-gray-400 text-lg max-w-2xl">Explications sceptiques, notes de terrain et lecture des signaux derriere les headlines.</p>
      </div>
    </div>
  </section>

  <section class="py-6 border-b border-dark-700 sticky top-16 lg:top-20 bg-dark-900/95 backdrop-blur-md z-40">
    <div class="section-padding max-w-7xl mx-auto">
      <BlogTabs locale={locale} active="insights" />
    </div>
  </section>

  <section class="py-12">
    <div class="section-padding max-w-7xl mx-auto">
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {sortedPosts.map((post) => (
          <article class="card card-hover flex flex-col">
            <a href={`/fr/blog/${post.data.urlSlug}`} class="block">
              <div class="aspect-video bg-dark-700 relative overflow-hidden">
                <img
                  src={getDefaultHeroImageForPost(post)}
                  alt={post.data.title}
                  class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                  loading="lazy"
                />
              </div>
            </a>
            <div class="p-6 flex-1 flex flex-col">
              <a href={`/fr/blog/${post.data.urlSlug}`} class="block mb-2">
                <h2 class="text-xl font-bold text-white hover:text-brand-400 transition-colors line-clamp-2">{post.data.title}</h2>
              </a>
              <p class="text-gray-400 text-sm line-clamp-2 mb-4 flex-1">{post.data.description}</p>
              <div class="flex items-center justify-between text-sm text-gray-500 pt-4 border-t border-dark-700">
                <span>{post.data.author}</span>
                <span>{post.data.pubDate.toLocaleDateString('fr-FR', { month: 'short', day: 'numeric', year: 'numeric' })}</span>
              </div>
            </div>
          </article>
        ))}
      </div>

      {sortedPosts.length === 0 && (
        <div class="text-center py-20">
          <div class="text-6xl mb-4">Notes</div>
          <h3 class="text-xl font-bold text-white mb-2">Pas encore d'Insights</h3>
          <p class="text-gray-400">Quand on publiera des Insights, ils apparaitront ici.</p>
        </div>
      )}
    </div>
  </section>
</Layout>
